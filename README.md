# 

è¿™ä¸ªPythonç¨‹åºå¯ä»¥ä»ç›‘è€ƒè§†é¢‘ä¸­æå–å·¦ä¸‹è§’å››åˆ†ä¹‹ä¸€ç”»é¢ï¼Œæ¯200msæˆªå–ä¸€å¸§ï¼Œä½¿ç”¨YOLOæ¨¡å‹æ£€æµ‹äººç‰©ï¼Œå¹¶ç”Ÿæˆæ ‡å‡†çš„YOLOæ ¼å¼æ•°æ®é›†ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¥ **è§†é¢‘å¤„ç†**: è‡ªåŠ¨å¤„ç†è§†é¢‘æ–‡ä»¶ï¼Œæå–æŒ‡å®šåŒºåŸŸ
- âœ‚ï¸ **æ™ºèƒ½è£å‰ª**: æå–å·¦ä¸‹è§’å››åˆ†ä¹‹ä¸€ç”»é¢
- â±ï¸ **å®šæ—¶æˆªå–**: å¯é…ç½®çš„æ—¶é—´é—´éš”æˆªå–å¸§ï¼ˆé»˜è®¤200msï¼‰
- ğŸ‘¥ **äººç‰©æ£€æµ‹**: ä½¿ç”¨YOLOæ¨¡å‹è‡ªåŠ¨æ£€æµ‹äººç‰©
- ğŸ“Š **æ•°æ®é›†ç”Ÿæˆ**: è¾“å‡ºæ ‡å‡†YOLOæ ¼å¼çš„æ•°æ®é›†
- ğŸ“ˆ **å¯è§†åŒ–**: å¯é€‰çš„æ£€æµ‹ç»“æœå¯è§†åŒ–åŠŸèƒ½

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
python video_to_yolo_dataset.py ä½ çš„è§†é¢‘æ–‡ä»¶.mp4
```

### é«˜çº§ç”¨æ³•

```bash
python video_to_yolo_dataset.py ä½ çš„è§†é¢‘æ–‡ä»¶.mp4 \
    --output_dir my_dataset \
    --interval 500 \
    --confidence 0.6 \
    --visualize
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `video_path` | str | å¿…éœ€ | è¾“å…¥è§†é¢‘æ–‡ä»¶è·¯å¾„ |
| `--output_dir` | str | `yolo_dataset` | è¾“å‡ºæ•°æ®é›†ç›®å½• |
| `--model` | str | `yolov8n.pt` | YOLOæ¨¡å‹æ–‡ä»¶è·¯å¾„ |
| `--interval` | int | `200` | å¸§æå–é—´éš”ï¼ˆæ¯«ç§’ï¼‰ |
| `--confidence` | float | `0.5` | æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼ |
| `--visualize` | flag | `False` | æ˜¯å¦å¯è§†åŒ–æ£€æµ‹ç»“æœ |

## è¾“å‡ºç»“æ„

ç¨‹åºè¿è¡Œåä¼šç”Ÿæˆä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
yolo_dataset/
â”œâ”€â”€ images/              # å›¾åƒæ–‡ä»¶
â”‚   â”œâ”€â”€ frame_000000.jpg
â”‚   â”œâ”€â”€ frame_000001.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ labels/              # YOLOæ ¼å¼æ ‡æ³¨æ–‡ä»¶
â”‚   â”œâ”€â”€ frame_000000.txt
â”‚   â”œâ”€â”€ frame_000001.txt
â”‚   â””â”€â”€ ...
â”œâ”€â”€ dataset.yaml         # æ•°æ®é›†é…ç½®æ–‡ä»¶
â””â”€â”€ detection_samples.png # æ£€æµ‹ç»“æœå¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰
```

## YOLOæ ‡æ³¨æ ¼å¼

æ¯ä¸ª`.txt`æ–‡ä»¶åŒ…å«æ£€æµ‹åˆ°çš„äººç‰©è¾¹ç•Œæ¡†ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºï¼š
```
class_id center_x center_y width height
```

å…¶ä¸­ï¼š
- `class_id`: ç±»åˆ«IDï¼ˆ0è¡¨ç¤ºäººï¼‰
- `center_x, center_y`: è¾¹ç•Œæ¡†ä¸­å¿ƒç‚¹åæ ‡ï¼ˆå½’ä¸€åŒ–åˆ°0-1ï¼‰
- `width, height`: è¾¹ç•Œæ¡†å®½åº¦å’Œé«˜åº¦ï¼ˆå½’ä¸€åŒ–åˆ°0-1ï¼‰

## ç¤ºä¾‹

### å¤„ç†ç›‘è€ƒè§†é¢‘

å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º`exam_video.mp4`çš„ç›‘è€ƒè§†é¢‘ï¼š

```bash
# åŸºæœ¬å¤„ç†ï¼Œæ¯200msæå–ä¸€å¸§
python video_to_yolo_dataset.py exam_video.mp4

# æ¯1ç§’æå–ä¸€å¸§ï¼Œç½®ä¿¡åº¦é˜ˆå€¼0.7ï¼Œå¹¶æ˜¾ç¤ºå¯è§†åŒ–ç»“æœ
python video_to_yolo_dataset.py exam_video.mp4 \
    --interval 1000 \
    --confidence 0.7 \
    --visualize \
    --output_dir exam_dataset
```

### åœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from video_to_yolo_dataset import VideoToYOLODataset

# åˆ›å»ºè½¬æ¢å™¨
converter = VideoToYOLODataset(
    video_path="your_video.mp4",
    output_dir="my_dataset",
    model_path="yolov8n.pt"
)

# æå–å¸§å¹¶æ£€æµ‹
num_frames = converter.extract_frames_and_detect(
    interval_ms=300,  # æ¯300msä¸€å¸§
    confidence_threshold=0.6
)

# å¯è§†åŒ–ç»“æœ
converter.visualize_detections(num_samples=10)
```

## æŠ€æœ¯è¯´æ˜

### è§†é¢‘åŒºåŸŸæå–

ç¨‹åºä¼šè‡ªåŠ¨è®¡ç®—å·¦ä¸‹è§’å››åˆ†ä¹‹ä¸€åŒºåŸŸï¼š
- è£å‰ªèµ·å§‹ç‚¹ï¼š(0, height/2)
- è£å‰ªå°ºå¯¸ï¼š(width/2, height/2)

### YOLOæ¨¡å‹

- é»˜è®¤ä½¿ç”¨YOLOv8næ¨¡å‹ï¼ˆè½»é‡çº§ï¼‰
- åªæ£€æµ‹äººç±»ï¼ˆCOCOæ•°æ®é›†ä¸­çš„class 0ï¼‰
- æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹è·¯å¾„

### æ€§èƒ½ä¼˜åŒ–

- åªåœ¨æŒ‡å®šé—´éš”å¤„ç†å¸§ï¼Œæé«˜å¤„ç†æ•ˆç‡
- ä½¿ç”¨ç½®ä¿¡åº¦é˜ˆå€¼è¿‡æ»¤ä½è´¨é‡æ£€æµ‹
- æ”¯æŒæ‰¹é‡å¤„ç†å’Œå¹¶è¡Œè®¡ç®—

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è§†é¢‘æ— æ³•æ‰“å¼€**
   - æ£€æŸ¥è§†é¢‘æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿è§†é¢‘æ ¼å¼å—OpenCVæ”¯æŒ

2. **YOLOæ¨¡å‹ä¸‹è½½å¤±è´¥**
   - é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹
   - æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶

3. **å†…å­˜ä¸è¶³**
   - å¢å¤§å¤„ç†é—´éš”ï¼ˆ--intervalï¼‰
   - ä½¿ç”¨æ›´å°çš„YOLOæ¨¡å‹

4. **æ£€æµ‹æ•ˆæœä¸ä½³**
   - è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ--confidenceï¼‰
   - å°è¯•ä½¿ç”¨æ›´å¤§çš„YOLOæ¨¡å‹

## ä¾èµ–ç‰ˆæœ¬

- Python >= 3.7
- OpenCV >= 4.5.0
- Ultralytics >= 8.0.0
- NumPy >= 1.21.0
- Matplotlib >= 3.5.0
- PyYAML >= 6.0

## è®¸å¯è¯

MIT License

# å¤šè·¯è§†é¢‘æµæ£€æµ‹è¯´æ˜

## é…ç½®æ–‡ä»¶config.yamlç¤ºä¾‹

```
weights: weight/best.pt
confidence: 0.7
names: ['wave', 'nowave']
device: cpu
alarm_dir: alarms
alarm_classes: [0, 1]  # 0: wave, 1: nowave
alarm_duration: 3  # ç§’
detect_interval_ms: 500  # æ£€æµ‹é—´éš”ï¼Œå•ä½ms
cooldown_seconds: 60  # æŠ¥è­¦å†·å´æ—¶é•¿ï¼Œå•ä½ç§’
streams:
  - name: cam1
    url: rtsp://example.com/stream1
  - name: cam2
    url: rtsp://example.com/stream2
```

- `streams`: é…ç½®å¤šè·¯è§†é¢‘æµï¼Œæ¯ä¸ªæµåŒ…å«nameå’Œurlã€‚
- `detect_interval_ms`: ç©ºé—²çŠ¶æ€ä¸‹æ¯éš”å¤šå°‘æ¯«ç§’æ£€æµ‹ä¸€å¸§ï¼ˆå¦‚500è¡¨ç¤ºæ¯500msæ£€æµ‹ä¸€æ¬¡ï¼‰ã€‚
- `cooldown_seconds`: æŠ¥è­¦åè¯¥æµå†·å´å¤šå°‘ç§’ï¼Œå†·å´æœŸé—´ä¸å†æ£€æµ‹ã€‚
- å…¶å®ƒå‚æ•°ä¸å•è·¯æ£€æµ‹ä¸€è‡´ã€‚

## è¿è¡Œæ–¹å¼

```
python detect_video.py
```

ç¨‹åºä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªæµå¯åŠ¨ç‹¬ç«‹è¿›ç¨‹ï¼Œäº’ä¸å½±å“ã€‚

## æ—¥å¿—ä¸æŠ¥è­¦

- æ¯è·¯æµçš„çŠ¶æ€å˜è¿ã€æŠ¥è­¦ã€å†·å´ç­‰ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†æ—¥å¿—ã€‚
- æŠ¥è­¦ç‰‡æ®µä»¥`{æµå}_{æ—¶é—´æˆ³}.mp4`å‘½åï¼Œä¿å­˜åœ¨`alarm_dir`ç›®å½•ä¸‹ã€‚ 